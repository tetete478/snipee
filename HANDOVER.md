# Snipee 開発引き継ぎドキュメント

**バージョン**: v1.5.21  
**最終更新**: 2025-12-02
**GitHub**: https://github.com/tetete478/snipee

---

## 📌 プロジェクト概要

### 目的

Clipy の代替として、チーム 20 人で使えるクロスプラットフォーム対応のクリップボード管理ツール。

### 主要機能

- クリップボード履歴管理（最大 100 件）
- Google Drive 経由でのスニペット共有（マスタスニペット）
- ローカルスニペット（個別スニペット）
- カスタマイズ可能なホットキー
- Mac/Windows 対応
- 自動アップデート機能（GitHub Releases 経由）
- 変数機能（日付、名前などの動的挿入）
- マスタ編集モード（パスワード: `1108`）
- XML エクスポート機能（Clipy 互換形式）
- 履歴専用ウィンドウ
- 初回ウェルカム画面（セットアップウィザード）
- DMG ドラッグインストール対応
- カラーテーマ機能（9 種類）

### 配布方針（最重要）

- **ダブルクリックで起動**（Node.js 不要）
- 非エンジニアでも簡単に使える
- 自動アップデートでユーザーは何もしなくて OK（※Windows のみ。Mac は署名対応後）

---

## 🔧 技術スタック

| 用途                    | 技術                                       |
| ----------------------- | ------------------------------------------ |
| フレームワーク          | Electron                                   |
| データ保存              | electron-store                             |
| XML 解析                | xml2js（Clipy 互換）                       |
| 自動ペースト（Mac）     | AppleScript + Bundle ID                    |
| 自動ペースト（Windows） | PowerShell + robotjs                       |
| 自動アップデート        | electron-updater + GitHub Releases         |
| ビルド                  | electron-builder                           |
| CI/CD                   | GitHub Actions（タグプッシュで自動ビルド） |

---

## 🚀 リリース手順

### 新バージョンのリリース

```bash
# 1. ソースコードをコミット＆プッシュ
git add .
git commit -m "v1.5.20: 変更内容"
git push

# 2. package.json のバージョンを更新（手動 or npm version）
# 手動の場合: package.json の "version" を編集

# 3. タグを作成してプッシュ → GitHub Actions が自動ビルド
git tag v1.5.20
git push origin v1.5.20
```

### 自動で実行されること

```
タグをプッシュ → GitHub Actions 起動 → Mac/Windows 並行ビルド → GitHub Releases にアップロード
```

### リリース後の確認

1. GitHub → Actions タブで両方のジョブが成功しているか確認
2. https://github.com/tetete478/snipee/releases にアクセス
3. Draft 状態なら「Edit」→「Publish release」をクリック

### リリース前のセキュリティチェック

```bash
npm audit          # 脆弱性チェック
npm audit fix      # 安全な範囲で自動修正
```

### ローカル開発

```bash
npx electron-rebuild  # robotjs のリビルド
npm start
```

---

## 📂 プロジェクト構造

```
snipee/
├── app/
│   ├── main.js               # メインプロセス
│   ├── index.html            # 簡易ホーム（クリップボード履歴）
│   ├── snippets.html         # スニペット専用ホーム
│   ├── history.html          # 履歴専用ウィンドウ
│   ├── snippet-editor.html   # スニペット編集画面
│   ├── settings.html         # 設定画面
│   ├── welcome.html          # 初回ウェルカム画面
│   ├── permission-guide.html # アクセシビリティ権限ガイド
│   └── common/
│       ├── variables.css     # CSS変数・テーマ定義
│       ├── common.css        # 共通スタイル
│       ├── utils.js          # 共通JavaScript
│       ├── theme.js          # テーマ管理
│       └── drag-drop.js      # ドラッグ&ドロップ
├── build/
│   ├── installer.nsh         # NSISカスタムスクリプト
│   ├── installerSidebar.bmp  # インストーラー画像
│   ├── icon.ico              # Windowsアイコン
│   ├── icon.icns             # Macアイコン
│   ├── icon.png              # アプリアイコン（512x512）
│   ├── tray_icon_16.png      # Macトレイ用（16x16）
│   ├── tray_icon_22.png      # Macトレイ用（22x22）
│   ├── tray_icon_32.png      # Macトレイ用（32x32）
│   └── dmg-background.png    # DMG背景画像
├── HANDOVER.md               # このファイル
└── UPDATE_LOG.md             # 更新履歴（ユーザー向け）
```

---

## ⚠️ 絶対やってはいけないこと

### 1. ❌ 複数ウィンドウ IPC 通信

**失敗**: サブメニュー用に別ウィンドウ作成 → アプリがフリーズ  
**解決**: 単一 HTML 内でインライン表示  
**教訓**: 新しいウィンドウを作る前に、必ずインライン表示で実装できないか検討

### 2. ❌ 同期処理で重い操作

**失敗**: 起動時に Google Drive 同期を同期実行 → 起動に 1 分  
**解決**: ホットキー登録を最優先、同期は非同期  
**教訓**: 起動順序は「ホットキー登録 → UI 表示 → データ同期」

### 3. ❌ デフォルトホットキーで競合

**失敗**: `Cmd+C/V` → 標準コピペと競合  
**解決**: `Command+Control+C/V` (Mac), `Ctrl+Alt+C/V` (Windows)  
**教訓**: 修飾キー 2 つ以上使う

### 4. ❌ 同期処理で UI 更新

**失敗**: blur イベントで同期保存 → UI freeze  
**解決**: UI 更新を先に実行、保存は非同期  
**教訓**: `await` は必ず UI 更新の後に

### 5. ❌ data 属性に JSON 直接格納

**失敗**: `data-history-group='${JSON.stringify(items)}'` → 特殊文字でパースエラー  
**解決**: Base64 エンコード `btoa(encodeURIComponent(JSON.stringify(items)))`  
**教訓**: HTML データ属性に JSON を入れる時は必ずエンコード

### 6. ❌ 個別スニペットを config.json に保存

**失敗**: アンインストール/再インストールで個別スニペットが消える  
**解決**: 個別スニペット専用の別ファイル（personal-snippets.json）に保存  
**教訓**: ユーザーの大切なデータは設定ファイルと分離する

---

## 🎯 現在の状態（v1.5.20）

### 自動アップデート

| OS      | 状態                                        |
| ------- | ------------------------------------------- |
| Windows | ✅ 動作する（署名不要）                     |
| Mac     | ✅ 動作する（署名 + Notarization 対応済み） |

### データ保存（v1.5.20 で改善）

| データ             | ファイル                   | アンインストール時 |
| ------------------ | -------------------------- | ------------------ |
| 設定・履歴         | config.json                | 削除される         |
| マスタスニペット   | config.json                | 削除（再同期可）   |
| **個別スニペット** | **personal-snippets.json** | **残る** ✅        |

### カラーテーマ（9 種類）

| テーマ名   | 背景色    | 特徴           |
| ---------- | --------- | -------------- |
| Silver     | `#f5f5f7` | デフォルト     |
| Pearl      | `#f0eeeb` | ウォームグレー |
| Blush      | `#fce8e8` | ピンク         |
| Peach      | `#fde8d8` | オレンジ       |
| Cream      | `#fcf4d9` | イエロー       |
| Pistachio  | `#e4f5e8` | グリーン       |
| Aqua       | `#ddf2f5` | シアン         |
| Periwinkle | `#e4e8fc` | ブルー         |
| Wisteria   | `#ede4f5` | パープル       |

### 変数機能

| 変数                                              | 出力例                | 説明                   |
| ------------------------------------------------- | --------------------- | ---------------------- |
| `{今日:MM/DD}`                                    | `11/30`               | 今日の日付             |
| `{明日:MM/DD}`                                    | `12/01`               | 明日の日付             |
| `{2日後:M月D日:曜日短（毎月1日は除外して3日後）}` | `12月2日（月）`       | 2 日後（1 日除外）     |
| `{3日後:M月D日:曜日短（毎月1日は除外して4日後）}` | `12月3日（火）`       | 3 日後（1 日除外）     |
| `{タイムスタンプ}`                                | `2024/11/30 14:30:45` | 年月日＋時分秒         |
| `{名前}`                                          | `小松`                | 設定画面で登録した名前 |

### ホットキー（デフォルト）

| 機能           | Mac                 | Windows      |
| -------------- | ------------------- | ------------ |
| 簡易ホーム     | `Command+Control+C` | `Ctrl+Alt+C` |
| スニペット専用 | `Command+Control+V` | `Ctrl+Alt+V` |
| 履歴専用       | `Command+Control+X` | `Ctrl+Alt+X` |

### 既知の制限

- IME 有効時のホットキー不安定

---

## 🗓️ TODO

### 🔴 最優先

---

## 🏢 別部署展開計画（v1.6〜）

### 背景と目的

現在はてるやの部署（20 人）で使用中。今後、別部署にも展開予定（計 2 部署）。
管理者が「完全素人」でも運用できる仕組みが必要。

### 現状の課題

```
現在のフロー:
Clipyでスニペット作成 → XMLエクスポート → Google Driveにアップロード
        ↑
    素人には難しい
```

### 目指すフロー

```
新しいフロー:
Snipeeでスニペット編集 → 保存ボタン → Google Driveに自動アップロード
                                            ↓
                                    一般ユーザーに自動同期
```

---

### 🔐 権限管理設計（RBAC 方式）

#### RBAC とは

**Role-Based Access Control（役割ベースのアクセス制御）**

- 業界標準のベストプラクティス
- Slack、GitHub、Google Workspace など有名サービスが採用
- 「人」ではなく「役割」に権限を紐づける

#### 3 層構造

```
┌─────────────────────────────────────────┐
│  👑 オーナー（1人：てるや）              │
│  → 全権限 + オーナー譲渡                │
└─────────────────────────────────────────┘
                 │
┌─────────────────────────────────────────┐
│  🛡️ 部署管理者（部署ごとに複数人可）     │
│  → 担当部署のマスタ編集                 │
│  → Google Drive連携                    │
└─────────────────────────────────────────┘
                 │
┌─────────────────────────────────────────┐
│  👤 メンバー（一般ユーザー）             │
│  → スニペット閲覧・使用のみ             │
└─────────────────────────────────────────┘
```

#### 権限マトリクス

| 機能              | オーナー  |  部署管理者   | メンバー |
| ----------------- | :-------: | :-----------: | :------: |
| マスタ閲覧        | ✅ 全部署 | ✅ 自部署のみ |    ❌    |
| マスタ編集        | ✅ 全部署 | ✅ 自部署のみ |    ❌    |
| Google Drive 連携 |    ✅     |      ✅       |    ❌    |
| 部署追加/削除     |    ✅     |      ❌       |    ❌    |
| パスワード変更    | ✅ 全部署 |      ❌       |    ❌    |
| 同期状況確認      | ✅ 全部署 | ✅ 自部署のみ |    ❌    |
| 管理者ウィンドウ  |    ✅     |      ✅       |    ❌    |

#### 認証方式の選択肢

| 方式           | メリット             | デメリット         | 推奨         |
| -------------- | -------------------- | ------------------ | ------------ |
| パスワード方式 | 実装簡単、すぐ使える | 誰が編集したか不明 | Phase 1      |
| アカウント方式 | ログ取れる、セキュア | 実装コスト高       | Phase 2 以降 |

**推奨：ハイブリッド（段階的移行）**

- Phase 1: パスワード方式で実装（v1.6）
- Phase 2: アカウント方式に移行（v1.7〜）

#### データ構造案

```json
{
  "organization": {
    "name": "てるや株式会社",
    "owner": "teruya@example.com"
  },
  "roles": {
    "owner": {
      "password": "xxxx",
      "permissions": ["all"]
    },
    "deptA_admin": {
      "password": "yyyy",
      "permissions": ["dept-a"],
      "masterUrl": "https://drive.google.com/..."
    },
    "deptB_admin": {
      "password": "zzzz",
      "permissions": ["dept-b"],
      "masterUrl": "https://drive.google.com/..."
    }
  },
  "departments": [
    {
      "id": "dept-a",
      "name": "営業部",
      "admins": ["tanaka@example.com"]
    },
    {
      "id": "dept-b",
      "name": "開発部",
      "admins": ["suzuki@example.com"]
    }
  ]
}
```

---

### 🛡️ 管理者専用ウィンドウ

#### 概要

一般ユーザーには見えない、管理者専用の独立ウィンドウ。
パスワード認証後にのみアクセス可能。

#### アクセス方法

トレイメニュー → 「管理者モード」 → パスワード入力

#### オーナーでログイン時

```
┌─────────────────────────────────────────┐
│  🛡️ 管理者ウィンドウ                    │
├─────────────────────────────────────────┤
│ [マスタ管理] [権限設定] [同期状況]       │  ← 全タブ表示
├─────────────────────────────────────────┤
│                                         │
│  📝 マスタスニペット編集                 │
│  部署選択: [▼ 全部署 / 部署A / 部署B]   │  ← 全部署選択可能
│  ├── フォルダ追加/削除                  │
│  └── スニペット編集                     │
│                                         │
│  📤 Google Drive連携                    │
│  ├── アップロード                       │
│  └── 共有リンク発行                     │
│                                         │
│  👥 部署管理                            │
│  ├── 部署追加/削除                      │
│  └── パスワード変更                     │
│                                         │
└─────────────────────────────────────────┘
```

#### 部署管理者でログイン時

```
┌─────────────────────────────────────────┐
│  🛡️ 管理者ウィンドウ（部署A）           │
├─────────────────────────────────────────┤
│ [マスタ管理] [同期状況]                  │  ← 権限設定タブなし
├─────────────────────────────────────────┤
│                                         │
│  📝 マスタスニペット編集                 │
│  対象: 部署A                            │  ← 自部署固定
│  ├── フォルダ追加/削除                  │
│  └── スニペット編集                     │
│                                         │
│  📤 Google Drive連携                    │
│  ├── アップロード                       │
│  └── 共有リンク発行                     │
│                                         │
└─────────────────────────────────────────┘
```

#### ファイル構成

```
app/
├── admin.html          # 管理者メインウィンドウ
├── admin-login.html    # パスワード入力画面
```

---

### 📤 Google Drive API 連携

#### 必要なパッケージ

```bash
npm install googleapis
```

#### 認証方式

OAuth 2.0 認証を採用（管理者が Google アカウントでログイン）

スコープ: `drive.file`（自アプリ作成ファイルのみアクセス）

#### Google Cloud 設定（必要な作業）

1. Google Cloud Project を作成
2. Drive API を有効化
3. OAuth 同意画面を設定
4. OAuth 2.0 クライアント ID を取得

#### 機能

| 機能           | 説明                                          |
| -------------- | --------------------------------------------- |
| アップロード   | マスタスニペットを XML で Google Drive に保存 |
| 共有リンク発行 | 一般ユーザー配布用の URL を生成               |
| 同期状況確認   | 最終更新日時、ファイルサイズ等                |

---

### 📋 実装ロードマップ

#### Phase 1: 基盤構築（v1.6）

| #   | 作業                      | 見積もり |
| --- | ------------------------- | -------- |
| 1   | googleapis パッケージ追加 | 10 分    |
| 2   | OAuth 認証フロー実装      | 2 時間   |
| 3   | ファイルアップロード機能  | 1 時間   |
| 4   | 管理者ログイン画面        | 1 時間   |
| 5   | 管理者ウィンドウ UI       | 2 時間   |
| 6   | 2 層パスワード実装        | 1 時間   |
| 7   | テスト・デバッグ          | 2 時間   |

#### Phase 2: 権限管理強化（v1.6）

| #   | 作業                   | 見積もり |
| --- | ---------------------- | -------- |
| 1   | 権限設定ファイル実装   | 1 時間   |
| 2   | 役割別 UI 表示切り替え | 1 時間   |
| 3   | 部署別マスタ管理       | 2 時間   |
| 4   | 部署追加/削除機能      | 1 時間   |

#### Phase 3: ドキュメント整備（v1.6）

| #   | ドキュメント           | 対象         |
| --- | ---------------------- | ------------ |
| 1   | 管理者マニュアル       | 部署管理者   |
| 2   | ユーザーマニュアル     | 一般ユーザー |
| 3   | XML スニペット仕様書   | 管理者       |
| 4   | トラブルシューティング | 全員         |

#### Phase 4: 拡張機能（v1.7〜）

| #   | 機能                      | 説明                                 |
| --- | ------------------------- | ------------------------------------ |
| 1   | アカウント方式への移行    | Google アカウント認証                |
| 2   | 監査ログ                  | 誰がいつ何を変更したか記録           |
| 3   | 利用統計                  | アクティブユーザー数、ペースト回数等 |
| 4   | 管理ダッシュボード（Web） | 必要に応じて                         |

---

### 💾 コード量の目安

| 追加機能              | 増加量                    | 影響             |
| --------------------- | ------------------------- | ---------------- |
| Google Drive API 連携 | +50KB                     | 問題なし         |
| 権限管理システム      | +20KB                     | 問題なし         |
| 管理者ウィンドウ      | +30KB                     | 問題なし         |
| googleapis パッケージ | +数 MB                    | ビルドサイズ微増 |
| **合計**              | **約 100KB + パッケージ** | **余裕**         |

参考：現在の Snipee 約 200KB → 追加後 約 300KB（Electron アプリとしては軽量）

---

### 📊 利用統計（将来実装・オプション）

プライバシーに配慮し、**内容は見ない**統計のみ。

```
┌─────────────────────────────────────────┐
│  📊 利用状況（統計のみ）                 │
├─────────────────────────────────────────┤
│                                         │
│  部署A：20人                            │
│  ├── アクティブユーザー: 18人           │
│  ├── 個別スニペット総数: 234件          │
│  ├── 今週のペースト回数: 1,520回        │
│  └── よく使う時間帯: 10:00〜11:00       │
│                                         │
│  ※ スニペットの内容は見れない           │
│                                         │
└─────────────────────────────────────────┘
```

---

### ❌ 実装しないもの

| 機能               | 理由                         |
| ------------------ | ---------------------------- |
| 個別スニペット監視 | プライバシー・信頼関係の問題 |
| リアルタイム同期   | 複雑すぎる、現状で十分       |

### 🟡 Phase 3: 機能追加

- タグ機能（マスタ/個別スニペットにタグ付け、フィルタリング）
- 検索機能強化（スニペット内容の全文検索）
- お気に入り機能（よく使うスニペットをピン留め）
- 変数機能拡張（カスタム変数: `{会社名}` など）

### 🟢 UI/UX 改善

- snippet-editor.html タイトル・タグ表示改善
- フォントサイズ設定（ユーザーが調整可能）
- キーボードショートカット拡充

### 🔵 安定性・パフォーマンス

- Windows 自動ペースト改善（フォーカス管理の安定化）
- IME ホットキー問題（日本語入力時の不安定さ解消）
- エラーハンドリング（Google Drive 同期失敗時のリトライ）

### ⚪ v1.6 セキュリティ強化

以下は v1.6 で対応予定のセキュリティ改善項目:

#### contextIsolation / preload.js 移行

**現状**:

```javascript
nodeIntegration: true,
contextIsolation: false
```

**推奨設定**:

```javascript
nodeIntegration: false,
contextIsolation: true,
preload: path.join(__dirname, 'preload.js')
```

**影響範囲**:

- 全 HTML ファイルの `require('electron')` が使えなくなる
- preload.js 経由で API を公開する必要がある
- 対象ファイル: index.html, snippets.html, history.html, settings.html, snippet-editor.html, welcome.html, permission-guide.html

**作業内容**:

1. preload.js 新規作成（IPC API を exposeInMainWorld）
2. 各 HTML ファイルの `require()` を `window.api.xxx` に置換
3. main.js の BrowserWindow 設定を変更

#### CSP (Content-Security-Policy) 設定

**現状**: 未設定

**対応内容**:

- main.js で BrowserWindow 作成時に CSP ヘッダーを設定
- 外部スクリプト実行を制限
- XSS 攻撃を防止

#### Electron アップデート

**現状**: Electron 35.x（中程度の脆弱性あり）

**対応内容**:

- Electron 39.x へアップグレード
- 破壊的変更の確認・対応
- 全機能の動作検証

#### コード署名

**Windows**: 有料証明書が必要（$200〜/年）
**Mac**: Apple Developer Program（審査通過後）

### 🔘 コード最適化（v1.6 以降）

#### 重複コード共通化

以下の関数が複数ファイルに重複している:

| 関数名              | 存在するファイル                        | 対応            |
| ------------------- | --------------------------------------- | --------------- |
| `groupHistoryItems` | index.html, history.html                | utils.js へ移動 |
| `showInlineSubmenu` | index.html, history.html, snippets.html | utils.js へ移動 |

**作業内容**:

1. 各ファイルの関数を比較し、差分を確認
2. 共通化可能な部分を utils.js へ移動
3. 各ファイルから重複コードを削除
4. 全画面で動作確認

---

## ✅ 完了した作業

### v1.5.24（2025-12-07）

**Windows 自動ペースト大幅高速化:**

- PowerShell → koffi（Windows API 直接呼び出し）に移行
- 速度改善: 400-600ms → <1ms（約 100 倍高速化）
- 体感: 1 秒ラグ → ほぼ一瞬
- robotjs 完全削除（Mac: osascript、Windows: koffi に統一）
- デバッグログクリーンアップ（エラー時のみ出力）

### v1.5.21（2025-12-02）

**Mac 署名 & Notarization 対応:**

- Apple Developer Program 審査通過
- Developer ID Application 証明書を取得
- Developer ID Installer 証明書を取得
- GitHub Secrets に署名情報を設定（CSC_LINK, CSC_KEY_PASSWORD, APPLE_ID, APPLE_APP_SPECIFIC_PASSWORD, APPLE_TEAM_ID）
- package.json に署名設定追加（hardenedRuntime, notarize）
- build.yml に署名用環境変数追加
- Mac 自動アップデートが動作するように！🎉

**対応アーキテクチャ:**

- Intel Mac（x64）
- Apple Silicon（arm64 / M1, M2, M3, M4）

### v1.5.20（2025-11-30）

**カラーテーマ機能:**

- 9 種類のテーマを実装（Silver, Pearl, Blush, Peach, Cream, Pistachio, Aqua, Periwinkle, Wisteria）
- 設定画面「表示」タブにテーマ選択 UI 追加（カラードット形式）
- theme.js 新規作成（ThemeManager オブジェクト）
- variables.css にテーマ定義追加
- 全画面（index.html, snippets.html, history.html, snippet-editor.html, settings.html）でテーマ適用

**個別スニペット保護:**

- 個別スニペットを専用ファイル（personal-snippets.json）に分離
- アンインストール/再インストールでも個別スニペットが消えない
- 旧データ（config.json 内）からの自動移行機能
- installer.nsh 更新（確認ダイアログ削除、config.json のみ削除）

**履歴ホーム バグ修正:**

- 履歴グループ（16-30, 31-45）のサブメニューが開かない問題を修正
- 原因: data-history-group 属性の JSON 解析エラー（特殊文字）
- 解決: Base64 エンコード（btoa/atob + encodeURIComponent/decodeURIComponent）

**セキュリティ対応:**

- npm audit fix 実行（glob, js-yaml の脆弱性を修正）
- shell.openExternal の安全性確認（固定 URL のみで問題なし）
- エラーハンドリングの統一確認（問題なし）

**コード最適化:**

- settings.html の重複 escapeHtml 関数を削除（utils.js に既存）

**設定画面改善:**

- キーボードナビゲーション追加（←→: タブ切替、↑↓: 項目移動、Esc: 閉じる）

### v1.5.19（2025-11-30）

**Mac トレイアイコン修正:**

- 専用トレイアイコン追加（tray_icon_16.png, tray_icon_22.png, tray_icon_32.png）
- 背景透明、文字なし、白色アウトライン
- メニューバーに最適なサイズ（16x16〜32x32）
- main.js の createTray() で Mac 用に tray_icon_16.png を使用

**Mac 自動アップデート修正:**

- ZIP ファイル生成を追加（Mac の自動アップデートに必要）
- ※署名がないため現時点では動作しない。署名対応後に有効になる

**Windows インストーラー改善:**

- 起動中の Snipee を自動終了する機能を改善
- 確認ダイアログなしで自動終了（シンプル版）
- taskkill を 2 回実行 + 待機時間追加で確実に終了

**デバッグログ追加:**

- autoUpdater の各イベントにログ出力を追加
- アップデート確認・ダウンロード状況が確認可能に

### v1.5.18（2025-11-30）

**アイコン刷新:**

- 新デザイン: 青 → 紫 → ピンクの斜めグラデーション（Instagram 風）
- クリップボード + ハサミのモチーフ
- Mac/Windows/トレイ用アイコン一新

**DMG インストーラー改善（Mac）:**

- ドラッグ&ドロップで Applications フォルダへインストール
- グラデーション背景画像追加
- 矢印でドラッグ方向を示す UI

**ウェルカム画面改善:**

- ウィンドウ全体をドラッグ可能に

### v1.5.17（2025-11-30）

**新機能:**

- 初回ウェルカム画面（セットアップウィザード）
  - 4 ステップ: 機能紹介 → 名前入力 → ホットキー説明 → 完了
  - キーボード操作対応（Enter, Esc, 矢印キー）

**インストーラー改善（Windows）:**

- 起動中インストール時に終了を促すダイアログ
- アンインストール時に設定削除オプション
- スタートアップ登録オプション
- サイドバー画像追加

### v1.5.16（2025-11-29）

- マスタフォルダ同期バグ修正（XML 削除されたフォルダが残る問題）
- 自動アップデート UX 改善（設定画面で手動チェック、進捗表示）

### v1.5.13〜v1.5.15

- 履歴専用ウィンドウ実装
- 履歴グループ表示バグ修正
- アップデートチェック UX 改善

### v1.5.5〜v1.5.12

- 変数機能実装
- マスタ編集モード実装
- XML エクスポート機能
- Mac/Windows 自動ペースト実装
- GitHub Actions CI/CD 構築
- 設定画面完成（5 タブ構成）
- ユーザーマニュアル作成

### v1.5.0〜v1.5.3

- CSS/JavaScript 共通化（約 790 行削減）
- Steve Jobs 風グレーテーマ
- 自動アップデート機能
- KeyboardNavigator クラス

---

## 🛠️ 開発ルール

### コード修正時

1. **提案してから実装**: 修正内容を先に提示して許可を得る
2. **場所を明示**: ファイル名、行番号、修正タイプを明記
3. **共通化チェック**: 新しいコードを書く前に common/ に入れられないか確認

### リリース前チェックリスト

1. `npm audit` で脆弱性チェック
2. 全画面の動作確認
3. package.json のバージョン更新
4. HANDOVER.md / UPDATE_LOG.md 更新

### デバッグ

```javascript
ipcRenderer.send("log", "message"); // VSCodeターミナルに出力
```

---

## 🔍 トラブルシューティング

### ホットキーが効かない

| 原因           | 対処                 |
| -------------- | -------------------- |
| IME 有効時     | 英数モードに切り替え |
| 他アプリと競合 | 別のホットキーに変更 |
| 起動直後       | アプリを再起動       |

### Google Drive 同期失敗

| 原因           | 対処                                                  |
| -------------- | ----------------------------------------------------- |
| URL 不正       | `https://drive.google.com/file/d/FILE_ID/view` 形式に |
| 共有設定       | 「リンクを知っている全員」に設定                      |
| XML 形式エラー | Clipy からエクスポートしたファイルか確認              |

### 自動アップデートが動かない

| 原因                 | 対処                                     |
| -------------------- | ---------------------------------------- |
| 開発環境             | ビルドしたアプリでテスト                 |
| Release 下書き       | 「Publish release」をクリック            |
| リポジトリが Private | Public に変更                            |
| Mac で署名エラー     | Apple Developer Program 審査通過後に対応 |

### Mac「壊れているため開けません」

v1.5.21 以降は署名 + Notarization 済みのため、通常は発生しません。
もし発生した場合：

```bash
xattr -cr /Applications/Snipee.app
```

### Windows インストール時に「終了できません」

v1.5.19 で修正済み。自動的に Snipee を終了してインストールが続行される。

### Mac トレイアイコンが巨大/表示されない

| 原因                 | 対処                                  |
| -------------------- | ------------------------------------- |
| icon.png を直接使用  | tray_icon_16.png を使用（16x16 専用） |
| ファイルが存在しない | build/に tray*icon*\*.png を配置      |
| main.js のパスが違う | `../build/tray_icon_16.png` を確認    |

### 履歴グループのサブメニューが開かない

v1.5.20 で修正済み。履歴データの Base64 エンコードで特殊文字問題を解決。

### 個別スニペットが消えた

v1.5.20 以降は personal-snippets.json に保存されるため消えない。
v1.5.19 以前からのアップデート時は自動移行される。

---

## 📚 参考資料

- [Electron 公式ドキュメント](https://www.electronjs.org/docs)
- [electron-store](https://github.com/sindresorhus/electron-store)
- [electron-updater](https://www.electron.build/auto-update)
- [Clipy](https://clipy-app.com/)

---

**開発者**: てるや  
**最終更新**: 2025-11-30  
**現在のバージョン**: v1.5.20
