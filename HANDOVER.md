# Snipee 開発引き継ぎドキュメント

**バージョン**: v1.5.18  
**最終更新**: 2025-11-30  
**GitHub**: https://github.com/tetete478/snipee

---

## 📌 プロジェクト概要

### 目的

Clipy の代替として、チーム 20 人で使えるクロスプラットフォーム対応のクリップボード管理ツール。

### 主要機能

- クリップボード履歴管理（最大 100 件）
- Google Drive 経由でのスニペット共有（マスタスニペット）
- ローカルスニペット（個別スニペット）
- カスタマイズ可能なホットキー
- Mac/Windows 対応
- 自動アップデート機能（GitHub Releases 経由）
- 変数機能（日付、名前などの動的挿入）
- マスタ編集モード（パスワード: `1108`）
- XML エクスポート機能（Clipy 互換形式）
- 履歴専用ウィンドウ
- 初回ウェルカム画面（セットアップウィザード）
- **DMG ドラッグインストール対応** ← v1.5.18 NEW

### 配布方針（最重要）

- **ダブルクリックで起動**（Node.js 不要）
- 非エンジニアでも簡単に使える
- 自動アップデートでユーザーは何もしなくて OK

---

## 🔧 技術スタック

| 用途                    | 技術                                       |
| ----------------------- | ------------------------------------------ |
| フレームワーク          | Electron                                   |
| データ保存              | electron-store                             |
| XML 解析                | xml2js（Clipy 互換）                       |
| 自動ペースト（Mac）     | AppleScript + Bundle ID                    |
| 自動ペースト（Windows） | PowerShell + robotjs                       |
| 自動アップデート        | electron-updater + GitHub Releases         |
| ビルド                  | electron-builder                           |
| CI/CD                   | GitHub Actions（タグプッシュで自動ビルド） |

---

## 🚀 リリース手順

### 新バージョンのリリース

```bash
# 1. ソースコードをコミット＆プッシュ
git add .
git commit -m "v1.5.18: 変更内容"
git push

# 2. package.json のバージョンを更新（手動 or npm version）
# 手動の場合: package.json の "version" を編集

# 3. タグを作成してプッシュ → GitHub Actions が自動ビルド
git tag v1.5.18
git push origin v1.5.18
```

### 自動で実行されること

```
タグをプッシュ → GitHub Actions 起動 → Mac/Windows 並行ビルド → GitHub Releases にアップロード
```

### リリース後の確認

1. GitHub → Actions タブで両方のジョブが成功しているか確認
2. https://github.com/tetete478/snipee/releases にアクセス
3. Draft 状態なら「Edit」→「Publish release」をクリック

### ローカル開発

```bash
npx electron-rebuild  # robotjs のリビルド
npm start
```

---

## 📂 プロジェクト構造

```
snipee/
├── app/
│   ├── main.js               # メインプロセス
│   ├── index.html            # 簡易ホーム（クリップボード履歴）
│   ├── snippets.html         # スニペット専用ホーム
│   ├── history.html          # 履歴専用ウィンドウ
│   ├── snippet-editor.html   # スニペット編集画面
│   ├── settings.html         # 設定画面
│   ├── welcome.html          # 初回ウェルカム画面
│   ├── permission-guide.html # アクセシビリティ権限ガイド
│   └── common/
│       ├── variables.css     # CSS変数
│       ├── common.css        # 共通スタイル
│       ├── utils.js          # 共通JavaScript
│       └── drag-drop.js      # ドラッグ&ドロップ
├── build/
│   ├── installer.nsh         # NSISカスタムスクリプト
│   ├── installerSidebar.bmp  # インストーラー画像
│   ├── icon.ico              # Windowsアイコン
│   ├── icon.icns             # Macアイコン
│   ├── icon.png              # トレイアイコン ← v1.5.18 NEW
│   └── dmg-background.png    # DMG背景画像 ← v1.5.18 NEW
├── HANDOVER.md               # このファイル
└── UPDATE_LOG.md             # 更新履歴（ユーザー向け）
```

---

## ⚠️ 絶対やってはいけないこと

### 1. ❌ 複数ウィンドウ IPC 通信

**失敗**: サブメニュー用に別ウィンドウ作成 → アプリがフリーズ  
**解決**: 単一 HTML 内でインライン表示  
**教訓**: 新しいウィンドウを作る前に、必ずインライン表示で実装できないか検討

### 2. ❌ 同期処理で重い操作

**失敗**: 起動時に Google Drive 同期を同期実行 → 起動に 1 分  
**解決**: ホットキー登録を最優先、同期は非同期  
**教訓**: 起動順序は「ホットキー登録 → UI 表示 → データ同期」

### 3. ❌ デフォルトホットキーで競合

**失敗**: `Cmd+C/V` → 標準コピペと競合  
**解決**: `Command+Control+C/V` (Mac), `Ctrl+Alt+C/V` (Windows)  
**教訓**: 修飾キー 2 つ以上使う

### 4. ❌ 同期処理で UI 更新

**失敗**: blur イベントで同期保存 → UI freeze  
**解決**: UI 更新を先に実行、保存は非同期  
**教訓**: `await` は必ず UI 更新の後に

---

## 🎯 現在の状態（v1.5.18）

### 変数機能

| 変数                                              | 出力例                | 説明                   |
| ------------------------------------------------- | --------------------- | ---------------------- |
| `{今日:MM/DD}`                                    | `11/30`               | 今日の日付             |
| `{明日:MM/DD}`                                    | `12/01`               | 明日の日付             |
| `{2日後:M月D日:曜日短（毎月1日は除外して3日後）}` | `12月2日（月）`       | 2 日後（1 日除外）     |
| `{3日後:M月D日:曜日短（毎月1日は除外して4日後）}` | `12月3日（火）`       | 3 日後（1 日除外）     |
| `{タイムスタンプ}`                                | `2024/11/30 14:30:45` | 年月日＋時分秒         |
| `{名前}`                                          | `小松`                | 設定画面で登録した名前 |

### ホットキー（デフォルト）

| 機能           | Mac                 | Windows      |
| -------------- | ------------------- | ------------ |
| 簡易ホーム     | `Command+Control+C` | `Ctrl+Alt+C` |
| スニペット専用 | `Command+Control+V` | `Ctrl+Alt+V` |
| 履歴専用       | `Command+Control+X` | `Ctrl+Alt+X` |

### 既知の制限

- IME 有効時のホットキー不安定

---

## 🗓️ TODO

### Phase 3: 新機能追加

#### 1. タグ機能

- マスタスニペットタグ: XML に含まれる、全員共有
- 個別スニペットタグ: 個人が自由に設定、ローカル保存

#### 2. Windows 署名（優先度低）

- 「不明な発行元」警告を減らす
- 料金: Certum 約$200/年、DigiCert $400〜$500/年
- 判断: 20 人のチーム用なら今は不要

#### 3. リリース前のバグ探し

手動テストシナリオ:

1. 初回インストール → 起動 → ウェルカム画面
2. クリップボード履歴の追加/削除
3. スニペットの追加/編集/削除
4. ドラッグ&ドロップ
5. ホットキーの変更
6. Google Drive 同期
7. 仮想ディスプレイ切り替え
8. アプリ終了 → 再起動

---

## ✅ 完了した作業

### v1.5.18（2025-11-30）

**アイコン刷新:**

- 新デザイン: 青 → 紫 → ピンクの斜めグラデーション（Instagram 風）
- クリップボード + ハサミのモチーフ
- Mac/Windows/トレイ用アイコン一新

**DMG インストーラー改善（Mac）:**

- ドラッグ&ドロップで Applications フォルダへインストール
- グラデーション背景画像追加
- 矢印でドラッグ方向を示す UI

**ウェルカム画面改善:**

- ウィンドウ全体をドラッグ可能に

### v1.5.17（2025-11-30）

**新機能:**

- 初回ウェルカム画面（セットアップウィザード）
  - 4 ステップ: 機能紹介 → 名前入力 → ホットキー説明 → 完了
  - キーボード操作対応（Enter, Esc, 矢印キー）

**インストーラー改善（Windows）:**

- 起動中インストール時に終了を促すダイアログ
- アンインストール時に設定削除オプション
- スタートアップ登録オプション
- サイドバー画像追加

### v1.5.16（2025-11-29）

- マスタフォルダ同期バグ修正（XML 削除されたフォルダが残る問題）
- 自動アップデート UX 改善（設定画面で手動チェック、進捗表示）

### v1.5.13〜v1.5.15

- 履歴専用ウィンドウ実装
- 履歴グループ表示バグ修正
- アップデートチェック UX 改善

### v1.5.5〜v1.5.12

- 変数機能実装
- マスタ編集モード実装
- XML エクスポート機能
- Mac/Windows 自動ペースト実装
- GitHub Actions CI/CD 構築
- 設定画面完成（5 タブ構成）
- ユーザーマニュアル作成

### v1.5.0〜v1.5.3

- CSS/JavaScript 共通化（約 790 行削減）
- Steve Jobs 風グレーテーマ
- 自動アップデート機能
- KeyboardNavigator クラス

---

## 🛠️ 開発ルール

### コード修正時

1. **提案してから実装**: 修正内容を先に提示して許可を得る
2. **場所を明示**: ファイル名、行番号、修正タイプを明記
3. **共通化チェック**: 新しいコードを書く前に common/ に入れられないか確認

### デバッグ

```javascript
ipcRenderer.send("log", "message"); // VSCodeターミナルに出力
```

---

## 🔍 トラブルシューティング

### ホットキーが効かない

| 原因           | 対処                 |
| -------------- | -------------------- |
| IME 有効時     | 英数モードに切り替え |
| 他アプリと競合 | 別のホットキーに変更 |
| 起動直後       | アプリを再起動       |

### Google Drive 同期失敗

| 原因           | 対処                                                  |
| -------------- | ----------------------------------------------------- |
| URL 不正       | `https://drive.google.com/file/d/FILE_ID/view` 形式に |
| 共有設定       | 「リンクを知っている全員」に設定                      |
| XML 形式エラー | Clipy からエクスポートしたファイルか確認              |

### 自動アップデートが動かない

| 原因                 | 対処                          |
| -------------------- | ----------------------------- |
| 開発環境             | ビルドしたアプリでテスト      |
| Release 下書き       | 「Publish release」をクリック |
| リポジトリが Private | Public に変更                 |

### Mac「壊れているため開けません」

```bash
xattr -cr /Applications/Snipee.app
```

---

## 📚 参考資料

- [Electron 公式ドキュメント](https://www.electronjs.org/docs)
- [electron-store](https://github.com/sindresorhus/electron-store)
- [electron-updater](https://www.electron.build/auto-update)
- [Clipy](https://clipy-app.com/)

---

**開発者**: てるや  
**最終更新**: 2025-11-30  
**現在のバージョン**: v1.5.18
