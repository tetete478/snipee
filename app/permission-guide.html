<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£æ¨©é™ã®è¨­å®š</title>
  <link rel="stylesheet" href="common/variables.css">
  <link rel="stylesheet" href="common/common.css">
  <style>
    /* permission-guide.html å›ºæœ‰ã®ã‚¹ã‚¿ã‚¤ãƒ«ã®ã¿ */
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: flex-start;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
      overflow-y: auto;
    }

    .container {
      background: white;
      border-radius: 20px;
      padding: 24px 32px;
      max-width: 560px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      animation: slideUp 0.5s ease-out;
      margin: 20px 0;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .icon {
      text-align: center;
      font-size: 48px;
      margin-bottom: 12px;
      animation: bounce 2s infinite;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    h1 {
      text-align: center;
      color: #333;
      font-size: 22px;
      margin-bottom: 12px;
    }

    .subtitle {
      text-align: center;
      color: #666;
      font-size: 13px;
      margin-bottom: 20px;
      line-height: 1.5;
    }

    .steps {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
    }

    .step {
      display: flex;
      align-items: flex-start;
      margin-bottom: 12px;
    }

    .step:last-child {
      margin-bottom: 0;
    }

    .step-number {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 16px;
      flex-shrink: 0;
      margin-right: 16px;
    }

    .step-content {
      flex: 1;
    }

    .step-title {
      font-weight: 600;
      color: #333;
      font-size: 15px;
      margin-bottom: 4px;
    }

    .step-description {
      color: #666;
      font-size: 13px;
      line-height: 1.5;
    }

    .code {
      background: #fff;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      padding: 8px 12px;
      font-family: monospace;
      font-size: 12px;
      color: #e83e8c;
      margin-top: 8px;
      display: inline-block;
    }

    .buttons {
      display: flex;
      gap: 12px;
      justify-content: center;
    }

    .btn {
      padding: 14px 28px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 15px;
      font-weight: 600;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
    }

    .btn-secondary {
      background: #f0f0f0;
      color: #666;
    }

    .btn-secondary:hover {
      background: #e5e5e5;
    }

    .note {
      background: #fff9e6;
      border-left: 4px solid #ffc107;
      padding: 16px;
      border-radius: 8px;
      margin-top: 20px;
    }

    .note-title {
      font-weight: 600;
      color: #f57c00;
      font-size: 14px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .note-content {
      color: #666;
      font-size: 13px;
      line-height: 1.6;
    }

    .path {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 12px;
      margin: 12px 0;
      font-size: 13px;
      color: #555;
      text-align: center;
      font-weight: 500;
    }

    .arrow {
      color: #999;
      margin: 0 8px;
    }

    .status {
      text-align: center;
      margin-top: 20px;
      padding: 12px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
    }

    .status.checking {
      background: #e3f2fd;
      color: #1976d2;
    }

    .status.granted {
      background: #e8f5e9;
      color: #2e7d32;
    }

  </style>
</head>
<body>
  <div class="container">
    <div class="icon">ğŸ”</div>
    <h1>ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£æ¨©é™ãŒå¿…è¦ã§ã™</h1>
    <p class="subtitle">
      è‡ªå‹•ãƒšãƒ¼ã‚¹ãƒˆæ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€macOSã®ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£æ¨©é™ãŒå¿…è¦ã§ã™ã€‚<br>
      ä¸€åº¦è¨­å®šã™ã‚Œã°ã€ãšã£ã¨å¿«é©ã«ä½¿ãˆã¾ã™!
    </p>

    <div class="steps">
      <div class="step">
        <div class="step-number">1</div>
        <div class="step-content">
          <div class="step-title">ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã‚’é–‹ã</div>
          <div class="step-description">
            ä¸‹ã®ã€Œã‚·ã‚¹ãƒ†ãƒ è¨­å®šã‚’é–‹ãã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
          </div>
        </div>
      </div>

      <div class="step">
        <div class="step-number">2</div>
        <div class="step-content">
          <div class="step-title">ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ã«ç§»å‹•</div>
          <div class="step-description">
            ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ â†’ ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£
          </div>
          <div class="path">
            ğŸ”’ ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£<span class="arrow">â†’</span>â™¿ ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£
          </div>
        </div>
      </div>

      <div class="step">
        <div class="step-number">3</div>
        <div class="step-content">
          <div class="step-title">Snipeeã‚’ONã«ã™ã‚‹</div>
          <div class="step-description">
            ä¸€è¦§ã‹ã‚‰<span class="code">Snipee</span>ã¾ãŸã¯<span class="code">Electron</span>ã‚’æ¢ã—ã¦ã€ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹
          </div>
        </div>
      </div>

      <div class="step">
        <div class="step-number">4</div>
        <div class="step-content">
          <div class="step-title">ã‚¢ãƒ—ãƒªã‚’å†èµ·å‹•</div>
          <div class="step-description">
            è¨­å®šå¾Œã€ã“ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‰ã˜ã¦ã€ã‚¢ãƒ—ãƒªã‚’å†èµ·å‹•ã—ã¦ãã ã•ã„
          </div>
        </div>
      </div>
    </div>

    <div class="buttons">
      <button class="btn btn-primary" onclick="openSystemPreferences()">
        âš™ï¸ ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã‚’é–‹ã
      </button>
      <button class="btn btn-secondary" onclick="skipForNow()">
        å¾Œã§è¨­å®šã™ã‚‹
      </button>
    </div>

    <div class="note">
      <div class="note-title">ğŸ’¡ æ¨©é™ãªã—ã§ã‚‚ä½¿ãˆã¾ã™</div>
      <div class="note-content">
        æ¨©é™ã‚’è¨­å®šã—ãªãã¦ã‚‚ã€ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰å±¥æ­´ã®é–²è¦§ã‚„æ¤œç´¢ã¯ã§ãã¾ã™ã€‚<br>
        ãŸã ã—ã€Enterã‚’æŠ¼ã—ãŸå¾Œã«æ‰‹å‹•ã§ <strong>âŒ˜+V</strong> ã§ãƒšãƒ¼ã‚¹ãƒˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
      </div>
    </div>

    <div id="status" class="status" style="display: none;"></div>
  </div>

  <script>
    const { ipcRenderer } = require('electron');

    async function openSystemPreferences() {
      await ipcRenderer.invoke('open-system-preferences');
      
      // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
      const status = document.getElementById('status');
      status.className = 'status checking';
      status.textContent = 'âœ“ ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã‚’é–‹ãã¾ã—ãŸã€‚è¨­å®šå¾Œã€ã“ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‰ã˜ã¦ãã ã•ã„ã€‚';
      status.style.display = 'block';

      // 3ç§’ã”ã¨ã«æ¨©é™ãƒã‚§ãƒƒã‚¯
      const interval = setInterval(async () => {
        const hasPermission = await ipcRenderer.invoke('check-permission');
        if (hasPermission) {
          clearInterval(interval);
          status.className = 'status granted';
          status.textContent = 'âœ… æ¨©é™ãŒä»˜ä¸ã•ã‚Œã¾ã—ãŸ! ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‰ã˜ã¦ã‚¢ãƒ—ãƒªã‚’å†èµ·å‹•ã—ã¦ãã ã•ã„ã€‚';
          
          // è‡ªå‹•çš„ã«ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‰ã˜ã‚‹
          setTimeout(() => {
            closeWindow();
          }, 2000);
        }
      }, 3000);
    }

    function skipForNow() {
      closeWindow();
    }

    function closeWindow() {
      ipcRenderer.invoke('close-permission-window');
    }

    // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒè¡¨ç¤ºã•ã‚ŒãŸã‚‰æ¨©é™ãƒã‚§ãƒƒã‚¯
    window.addEventListener('load', async () => {
      const hasPermission = await ipcRenderer.invoke('check-permission');
      if (hasPermission) {
        // ã™ã§ã«æ¨©é™ãŒã‚ã‚‹å ´åˆã¯è‡ªå‹•çš„ã«é–‰ã˜ã‚‹
        const status = document.getElementById('status');
        status.className = 'status granted';
        status.textContent = 'âœ… æ¨©é™ã¯æ—¢ã«ä»˜ä¸ã•ã‚Œã¦ã„ã¾ã™!';
        status.style.display = 'block';
        
        setTimeout(() => {
          closeWindow();
        }, 2000);
      }
    });
  </script>
</body>
</html>
