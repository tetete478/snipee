<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Snipee è¨­å®š</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', 'Hiragino Sans', sans-serif;
      background: #f5f5f5;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    .container {
      width: 420px;
      height: 800px;
      max-height: 95vh;
      background: #ffffff;
      display: flex;
      flex-direction: column;
    }

    .header {
      background: #ffffff;
      padding: 20px;
      border-bottom: 1px solid #e0e0e0;
      -webkit-app-region: drag;
    }
    
    .header h1 {
      font-size: 20px;
      font-weight: 600;
      color: #333;
      margin: 0;
    }

    .content {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      -webkit-app-region: no-drag;
    }

    .section {
      background: #fafafa;
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 10px;
      border: 1px solid #e8e8e8;
    }

    .section:last-child {
      margin-bottom: 0;
    }

    .section-header {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 8px;
      cursor: move;
    }

    .section-header h2 {
      font-size: 14px;
      font-weight: 600;
      color: #333;
    }

    .section-description {
      font-size: 11px;
      color: #777;
      margin-bottom: 10px;
      line-height: 1.4;
      cursor: move;
    }

    .form-group {
      margin-bottom: 10px;
      -webkit-app-region: no-drag;
    }

    .form-group:last-child {
      margin-bottom: 0;
    }

    label {
      display: block;
      margin-bottom: 4px;
      color: #444;
      font-size: 12px;
      font-weight: 500;
      -webkit-app-region: no-drag;
    }

    input[type="text"],
    input[type="url"] {
      width: 100%;
      padding: 7px 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 12px;
      font-family: inherit;
      transition: all 0.2s;
      background: #ffffff;
      -webkit-app-region: no-drag;
    }

    input[type="text"]:focus,
    input[type="url"]:focus {
      outline: none;
      border-color: #007aff;
      box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
    }

    input[readonly] {
      background: #f5f5f5;
      cursor: not-allowed;
      color: #666;
    }

    .help-text {
      font-size: 10px;
      color: #888;
      margin-top: 3px;
      line-height: 1.3;
    }

    .btn {
      padding: 6px 12px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      -webkit-app-region: no-drag;
    }

    .btn:active {
      transform: translateY(1px);
    }

    .btn-primary {
      background: #007aff;
      color: white;
    }

    .btn-primary:hover {
      background: #0051d5;
    }

    .btn-success {
      background: #34c759;
      color: white;
    }

    .btn-success:hover {
      background: #2da64a;
    }

    .btn-secondary {
      background: #f0f0f0;
      color: #333;
      border: 1px solid #ddd;
    }

    .btn-secondary:hover {
      background: #e5e5e5;
    }

    .btn-group {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .alert {
      padding: 8px 10px;
      border-radius: 4px;
      margin-bottom: 8px;
      font-size: 11px;
      display: none;
      align-items: center;
      gap: 6px;
    }

    .alert.show {
      display: flex;
    }

    .alert-success {
      background: #e8f5e9;
      border: 1px solid #a5d6a7;
      color: #2e7d32;
    }

    .alert-error {
      background: #ffebee;
      border: 1px solid #ef9a9a;
      color: #c62828;
    }

    .alert-info {
      background: #e3f2fd;
      border: 1px solid #90caf9;
      color: #1565c0;
    }

    .link-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .link-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 10px;
      background: #ffffff;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      font-size: 12px;
      transition: all 0.2s;
      -webkit-app-region: no-drag;
    }

    .link-item:hover {
      background: #f8f9fa;
      border-color: #007aff;
    }

    .link-item a {
      color: #007aff;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 5px;
      flex: 1;
    }

    .link-item a:hover {
      text-decoration: underline;
    }

    .hotkey-display {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    .hotkey-display label {
      margin-bottom: 0;
      min-width: 100px;
    }

    .hotkey-display input {
      flex: 1;
    }

    .hotkey-display .btn {
      flex-shrink: 0;
    }

    .sync-status {
      background: #ffffff;
      padding: 8px 10px;
      border-radius: 4px;
      border: 1px solid #e0e0e0;
      font-size: 11px;
      color: #666;
      margin-top: 8px;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.4);
      justify-content: center;
      align-items: center;
      z-index: 1000;
      -webkit-app-region: no-drag;
    }

    .modal.show {
      display: flex;
    }

    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 10px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
      -webkit-app-region: no-drag;
    }

    .modal-header {
      margin-bottom: 12px;
    }

    .modal-header h3 {
      font-size: 15px;
      font-weight: 600;
      color: #333;
    }

    .modal-actions {
      margin-top: 12px;
      display: flex;
      justify-content: flex-end;
      gap: 8px;
    }

    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #f5f5f5;
    }

    ::-webkit-scrollbar-thumb {
      background: #ccc;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #aaa;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ“‹ Snipee è¨­å®š</h1>
    </div>

    <div class="content">
      <div class="section">
        <div class="section-header">
          <h2>ğŸ“– ãƒãƒ‹ãƒ¥ã‚¢ãƒ«</h2>
        </div>
        <div class="section-description">
          Snipeeã®ä½¿ã„æ–¹ã‚„è©³ç´°æƒ…å ±ã¯ã“ã¡ã‚‰ã‚’ã”è¦§ãã ã•ã„ã€‚
        </div>
        
        <div class="link-list">
          <div class="link-item">
            <a href="#" onclick="openExternal('https://github.com/tetete478/snipee/blob/main/MANUAL.md'); return false;">
              ğŸ“š ä½¿ã„æ–¹ãƒãƒ‹ãƒ¥ã‚¢ãƒ«
            </a>
          </div>
          <div class="link-item">
            <a href="#" onclick="openExternal('https://github.com/yourusername/snipee/issues'); return false;">
              ğŸ› ãƒã‚°å ±å‘Šãƒ»æ©Ÿèƒ½ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
            </a>
          </div>
        </div>
      </div>

      <div class="section">
        <div class="section-header">
          <h2>âŒ¨ï¸ ãƒ›ãƒƒãƒˆã‚­ãƒ¼è¨­å®š</h2>
        </div>
        <div class="section-description">
          ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰å±¥æ­´ã¨ã‚¹ãƒ‹ãƒšãƒƒãƒˆå°‚ç”¨ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‹ããƒ›ãƒƒãƒˆã‚­ãƒ¼ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã¾ã™ã€‚
        </div>
        
        <div class="form-group">
          <div class="hotkey-display">
            <label>ç°¡æ˜“ãƒ›ãƒ¼ãƒ </label>
            <input type="text" id="hotkey-main" readonly>
            <button class="btn btn-secondary" onclick="showHotkeyModal('main')">å¤‰æ›´</button>
          </div>
          <div class="help-text">
            ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰å±¥æ­´ã‚’é–‹ãã¾ã™ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: <span id="default-main">Option+Shift+C</span>ï¼‰
          </div>
        </div>

        <div class="form-group">
          <div class="hotkey-display">
            <label>ã‚¹ãƒ‹ãƒšãƒƒãƒˆå°‚ç”¨</label>
            <input type="text" id="hotkey-snippet" readonly>
            <button class="btn btn-secondary" onclick="showHotkeyModal('snippet')">å¤‰æ›´</button>
          </div>
          <div class="help-text">
            ã‚¹ãƒ‹ãƒšãƒƒãƒˆä¸€è¦§ã‚’é–‹ãã¾ã™ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: <span id="default-snippet">Option+Shift+V</span>ï¼‰
          </div>
        </div>

        <div class="btn-group">
          <button class="btn btn-secondary" onclick="resetAllHotkeys()">ğŸ”„ ã™ã¹ã¦ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™</button>
        </div>
      </div>

      <div class="section">
        <div class="section-header">
          <h2>ğŸ”„ å…±æœ‰ã‚¹ãƒ‹ãƒšãƒƒãƒˆåŒæœŸ</h2>
        </div>
        <div class="section-description">
          Google Driveã§ãƒãƒ¼ãƒ å…¨ä½“ã®ã‚¹ãƒ‹ãƒšãƒƒãƒˆã‚’å…±æœ‰ã§ãã¾ã™ã€‚JSONå½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€å…±æœ‰ãƒªãƒ³ã‚¯ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚
        </div>
        
        <div id="sync-alert" class="alert"></div>

        <div class="form-group">
          <label>Google Driveå…±æœ‰ãƒªãƒ³ã‚¯URL</label>
          <input type="url" id="master-url" placeholder="https://drive.google.com/file/d/...">
          <div class="help-text">
            ãƒ•ã‚¡ã‚¤ãƒ« â†’ å…±æœ‰ â†’ ãƒªãƒ³ã‚¯ã‚’çŸ¥ã£ã¦ã„ã‚‹å…¨å“¡ â†’ ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼
          </div>
        </div>
        
        <div class="btn-group">
          <button class="btn btn-primary" onclick="saveMasterUrl()">ğŸ’¾ ä¿å­˜ã—ã¦åŒæœŸ</button>
          <button class="btn btn-success" onclick="manualSync()">ğŸ”„ æ‰‹å‹•åŒæœŸ</button>
        </div>

        <div class="sync-status" id="sync-status">
          æœ€çµ‚åŒæœŸ: æœªåŒæœŸ
        </div>
      </div>

      <div class="section">
        <div class="section-header">
          <h2>ğŸ‘ï¸ ãƒ•ã‚©ãƒ«ãƒ€ã®è¡¨ç¤ºè¨­å®š</h2>
        </div>
        <div class="section-description">
          è¡¨ç¤ºã—ãŸããªã„ãƒ•ã‚©ãƒ«ãƒ€ã®ãƒã‚§ãƒƒã‚¯ã‚’å¤–ã—ã¦ãã ã•ã„ã€‚ãƒã‚§ãƒƒã‚¯ã‚’å¤–ã—ãŸãƒ•ã‚©ãƒ«ãƒ€ã¯ç°¡æ˜“ãƒ›ãƒ¼ãƒ ã¨ã‚¹ãƒ‹ãƒšãƒƒãƒˆå°‚ç”¨ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã«è¡¨ç¤ºã•ã‚Œãªããªã‚Šã¾ã™ã€‚
        </div>
        
        <div id="folder-alert" class="alert"></div>

        <div id="folder-list" style="max-height: 300px; overflow-y: auto; background: #ffffff; border: 1px solid #e0e0e0; border-radius: 4px; padding: 8px;">
          <div style="text-align: center; padding: 20px; color: #999; font-size: 12px;">
            ãƒ•ã‚©ãƒ«ãƒ€ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...
          </div>
        </div>

        <div class="btn-group" style="margin-top: 8px;">
          <button class="btn btn-primary" onclick="saveFolderSettings()">ğŸ’¾ è¨­å®šã‚’ä¿å­˜</button>
          <button class="btn btn-secondary" onclick="selectAllFolders()">â˜‘ï¸ ã™ã¹ã¦è¡¨ç¤º</button>
          <button class="btn btn-secondary" onclick="deselectAllFolders()">â˜ ã™ã¹ã¦éè¡¨ç¤º</button>
        </div>
      </div>

      <div class="section">
        <div class="section-header">
          <h2>ğŸ“ ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ä½ç½®è¨­å®š</h2>
        </div>
        <div class="section-description">
          ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®è¡¨ç¤ºä½ç½®ã‚’è¨­å®šã§ãã¾ã™ã€‚
        </div>
        
        <div style="display: flex; flex-direction: column; gap: 8px;">
          <label style="display: flex; align-items: center; cursor: pointer;">
            <input type="radio" name="windowPosition" value="cursor" style="margin-right: 8px;">
            <span>ãƒã‚¦ã‚¹ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ã«è¡¨ç¤º</span>
          </label>
          <label style="display: flex; align-items: center; cursor: pointer;">
            <input type="radio" name="windowPosition" value="previous" style="margin-right: 8px;">
            <span>å‰å›ã®ä½ç½®ã«è¡¨ç¤º</span>
          </label>
        </div>
        <p style="margin: 8px 0 0 0; font-size: 11px; color: #666;">
          ã€Œå‰å›ã®ä½ç½®ã€ã‚’é¸ã¶ã¨ã€ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’ç§»å‹•ã—ãŸä½ç½®ã‚’è¨˜æ†¶ã—ã¾ã™
        </p>
      </div>
    </div>
  </div>

  <div class="modal" id="hotkey-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modal-title">ãƒ›ãƒƒãƒˆã‚­ãƒ¼ã‚’å¤‰æ›´</h3>
      </div>
      
      <div class="form-group">
        <label>æ–°ã—ã„ãƒ›ãƒƒãƒˆã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ãã ã•ã„</label>
        <input type="text" id="hotkey-input" readonly placeholder="ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ãã ã•ã„..." 
              style="font-size: 16px; text-align: center; padding: 16px; background: #f8f9fa;">
        <div class="help-text">
          Modifierã‚­ãƒ¼ï¼ˆCommand, Control, Alt, Shiftï¼‰ã¨ã‚­ãƒ¼ã®çµ„ã¿åˆã‚ã›ã‚’æŠ¼ã—ã¦ãã ã•ã„
        </div>
      </div>

      <div id="hotkey-error" style="display: none; color: #dc3545; font-size: 12px; margin-top: 8px; padding: 8px; background: #ffebee; border-radius: 4px;">
      </div>
      
      <div class="modal-actions">
        <button class="btn btn-secondary" onclick="closeHotkeyModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button class="btn btn-primary" id="save-hotkey-btn" onclick="saveHotkey()" disabled>ä¿å­˜</button>
      </div>
    </div>
  </div>

  <script>
    const { ipcRenderer, shell } = require('electron');
    const Store = require('electron-store');
    const store = new Store();
    
    let capturedHotkey = null;
    let currentEditingType = null;

    const isMac = process.platform === 'darwin';

    window.addEventListener('DOMContentLoaded', async () => {
      if (!isMac) {
        document.getElementById('default-main').textContent = 'Alt+Shift+C';
        document.getElementById('default-snippet').textContent = 'Alt+Shift+V';
      }

      await loadHotkeys();
      await loadSyncStatus();

      const masterUrl = store.get('masterSnippetUrl', '');
      document.getElementById('master-url').value = masterUrl;

      await loadFolders();
      loadWindowPositionSetting();

      // ãƒ¢ãƒ¼ãƒ€ãƒ«èƒŒæ™¯ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
      document.getElementById('hotkey-modal').addEventListener('click', (e) => {
        if (e.target.id === 'hotkey-modal') {
          closeHotkeyModal();
        }
      });

      // ãƒ›ãƒƒãƒˆã‚­ãƒ¼å…¥åŠ›
      document.getElementById('hotkey-input').addEventListener('keydown', (e) => {
        if (!document.getElementById('hotkey-modal').classList.contains('show')) return;
        
        e.preventDefault();
        e.stopPropagation();
        
        let key = e.code;

        if (['MetaLeft', 'MetaRight', 'ControlLeft', 'ControlRight', 'AltLeft', 'AltRight', 'ShiftLeft', 'ShiftRight'].includes(key)) {
          return;
        }

        if (key.startsWith('Key')) {
          key = key.replace('Key', '');
        } else if (key.startsWith('Digit')) {
          key = key.replace('Digit', '');
        } else {
          key = e.key;
        }
        
        const modifiers = [];
        if (e.metaKey) modifiers.push('Command');
        if (e.ctrlKey && !e.metaKey) modifiers.push('Control');
        if (e.altKey) modifiers.push('Alt');  
        if (e.shiftKey) modifiers.push('Shift');
        
        if (modifiers.length === 0) {
          document.getElementById('hotkey-error').textContent = 'âš ï¸ Modifierã‚­ãƒ¼ï¼ˆCommand, Control, Alt, Shiftï¼‰ã¨çµ„ã¿åˆã‚ã›ã¦ãã ã•ã„';
          document.getElementById('hotkey-error').style.display = 'block';
          document.getElementById('save-hotkey-btn').disabled = true;
          return;
        }
        
        const hotkeyStr = [...modifiers, key].join('+');
        
        document.getElementById('hotkey-input').value = hotkeyStr;
        capturedHotkey = hotkeyStr;
        
        document.getElementById('hotkey-error').style.display = 'none';
        document.getElementById('save-hotkey-btn').disabled = false;
      });

      // Escã‚­ãƒ¼å‡¦ç†
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          const modal = document.getElementById('hotkey-modal');
          if (modal.classList.contains('show')) {
            closeHotkeyModal();
          } else {
            ipcRenderer.invoke('hide-settings-window');
          }
        }
      });
    });

    async function loadHotkeys() {
      const mainHotkey = await ipcRenderer.invoke('get-current-hotkey', 'main');
      const snippetHotkey = await ipcRenderer.invoke('get-current-hotkey', 'snippet');
      
      document.getElementById('hotkey-main').value = mainHotkey || (isMac ? 'Option+Shift+C' : 'Alt+Shift+C');
      document.getElementById('hotkey-snippet').value = snippetHotkey || (isMac ? 'Option+Shift+V' : 'Alt+Shift+V');
    }

    async function loadSyncStatus() {
      const lastSync = store.get('lastSync');
      const statusDiv = document.getElementById('sync-status');
      
      if (lastSync) {
        const date = new Date(lastSync);
        statusDiv.textContent = `æœ€çµ‚åŒæœŸ: ${date.toLocaleString('ja-JP')}`;
      } else {
        statusDiv.textContent = 'æœ€çµ‚åŒæœŸ: æœªåŒæœŸ';
      }
    }

    function openExternal(url) {
      shell.openExternal(url);
    }

    function showHotkeyModal(type) {
      currentEditingType = type;
      capturedHotkey = null;
      
      const title = type === 'main' ? 'ç°¡æ˜“ãƒ›ãƒ¼ãƒ ã®ãƒ›ãƒƒãƒˆã‚­ãƒ¼ã‚’å¤‰æ›´' : 'ã‚¹ãƒ‹ãƒšãƒƒãƒˆå°‚ç”¨ã®ãƒ›ãƒƒãƒˆã‚­ãƒ¼ã‚’å¤‰æ›´';
      document.getElementById('modal-title').textContent = title;
      document.getElementById('hotkey-input').value = '';
      document.getElementById('hotkey-error').style.display = 'none';
      document.getElementById('save-hotkey-btn').disabled = true;
      document.getElementById('hotkey-modal').classList.add('show');
      
      setTimeout(() => {
        document.getElementById('hotkey-input').focus();
      }, 100);
    }

    function closeHotkeyModal() {
      document.getElementById('hotkey-modal').classList.remove('show');
      capturedHotkey = null;
      currentEditingType = null;
    }

    async function saveHotkey() {
      if (!capturedHotkey || !currentEditingType) return;
      
      const result = await ipcRenderer.invoke('set-hotkey', currentEditingType, capturedHotkey);
      
      if (result.success) {
        closeHotkeyModal();
        await loadHotkeys();
        showAlert('âœ… ãƒ›ãƒƒãƒˆã‚­ãƒ¼ã‚’å¤‰æ›´ã—ã¾ã—ãŸã€‚', 'success', 'sync-alert');
      } else {
        document.getElementById('hotkey-error').textContent = `âŒ ${result.error}`;
        document.getElementById('hotkey-error').style.display = 'block';
      }
    }

    async function resetAllHotkeys() {
      if (!confirm('ã™ã¹ã¦ã®ãƒ›ãƒƒãƒˆã‚­ãƒ¼ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã—ã¾ã™ã‹?')) return;
      
      await ipcRenderer.invoke('reset-all-hotkeys');
      await loadHotkeys();
      showAlert('âœ… ã™ã¹ã¦ã®ãƒ›ãƒƒãƒˆã‚­ãƒ¼ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã—ã¾ã—ãŸã€‚', 'success', 'sync-alert');
    }

    async function saveMasterUrl() {
      const url = document.getElementById('master-url').value.trim();
      if (!url) {
        showAlert('URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error', 'sync-alert');
        return;
      }

      const result = await ipcRenderer.invoke('set-master-url', url);
      if (result) {
        showAlert('âœ… ãƒã‚¹ã‚¿ãƒ¼URLã‚’ä¿å­˜ã—ã€åŒæœŸã—ã¾ã—ãŸ', 'success', 'sync-alert');
        await loadSyncStatus();
        await loadFolders();
      } else {
        showAlert('âŒ åŒæœŸã«å¤±æ•—ã—ã¾ã—ãŸã€‚URLã‚’ç¢ºèªã—ã¦ãã ã•ã„', 'error', 'sync-alert');
      }
    }

    async function manualSync() {
      const result = await ipcRenderer.invoke('manual-sync');
      if (result.success && result.lastSync) {
        showAlert('âœ… åŒæœŸå®Œäº†ã—ã¾ã—ãŸ', 'success', 'sync-alert');
        await loadSyncStatus();
        await loadFolders();
      } else {
        showAlert('âŒ åŒæœŸã«å¤±æ•—ã—ã¾ã—ãŸã€‚URLã‚’ç¢ºèªã—ã¦ãã ã•ã„', 'error', 'sync-alert');
      }
    }

    function showAlert(message, type = 'info', elementId = 'sync-alert') {
      const alert = document.getElementById(elementId);
      alert.className = `alert alert-${type} show`;
      alert.textContent = message;
      
      setTimeout(() => {
        alert.classList.remove('show');
      }, 5000);
    }

    async function loadFolders() {
      const data = await ipcRenderer.invoke('get-all-items');
      const masterSnippets = data.masterSnippets || [];
      const folders = [...new Set(masterSnippets.map(s => s.folder || 'æœªåˆ†é¡'))];
      const hiddenFolders = store.get('hiddenFolders', []);
      
      const folderListDiv = document.getElementById('folder-list');
      
      if (folders.length === 0) {
        folderListDiv.innerHTML = '<div style="text-align: center; padding: 20px; color: #999; font-size: 12px;">ãƒ•ã‚©ãƒ«ãƒ€ãŒã‚ã‚Šã¾ã›ã‚“</div>';
        return;
      }
      
      folderListDiv.innerHTML = folders.map(folder => `
        <div style="padding: 8px; border-bottom: 1px solid #f0f0f0; display: flex; align-items: center; gap: 8px;">
          <input type="checkbox" 
                 id="folder-${escapeAttr(folder)}" 
                 value="${escapeAttr(folder)}" 
                 ${!hiddenFolders.includes(folder) ? 'checked' : ''}
                 style="width: 16px; height: 16px; cursor: pointer;">
          <label for="folder-${escapeAttr(folder)}" 
                 style="flex: 1; cursor: pointer; font-size: 12px; color: #333; margin-bottom: 0;">
            ${escapeHtml(folder)}
          </label>
        </div>
      `).join('');
    }

    async function loadWindowPositionSetting() {
      const positionMode = store.get('windowPositionMode', 'cursor');
      
      const radioButtons = document.querySelectorAll('input[name="windowPosition"]');
      radioButtons.forEach(radio => {
        if (radio.value === positionMode) {
          radio.checked = true;
        }
      });
    }

    async function saveFolderSettings() {
      const checkboxes = document.querySelectorAll('#folder-list input[type="checkbox"]');
      const hiddenFolders = [];
      
      checkboxes.forEach(checkbox => {
        if (!checkbox.checked) {
          hiddenFolders.push(checkbox.value);
        }
      });
      
      store.set('hiddenFolders', hiddenFolders);
      showAlert(`âœ… ãƒ•ã‚©ãƒ«ãƒ€è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸï¼ˆ${hiddenFolders.length}å€‹ã®ãƒ•ã‚©ãƒ«ãƒ€ã‚’éè¡¨ç¤ºï¼‰`, 'success', 'folder-alert');

      const selectedPosition = document.querySelector('input[name="windowPosition"]:checked');
      if (selectedPosition) {
        store.set('windowPositionMode', selectedPosition.value);
      }
    }

    function selectAllFolders() {
      const checkboxes = document.querySelectorAll('#folder-list input[type="checkbox"]');
      checkboxes.forEach(checkbox => checkbox.checked = true);
    }

    function deselectAllFolders() {
      const checkboxes = document.querySelectorAll('#folder-list input[type="checkbox"]');
      checkboxes.forEach(checkbox => checkbox.checked = false);
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function escapeAttr(text) {
      return text.replace(/"/g, '&quot;').replace(/'/g, '&#39;');
    }
  </script>
</body>
</html>